"use strict";
var _ = require('lodash');
var functionMatcher = new RegExp("scala\\.Function\\d{1,2}");
var scalaPackageMatcher = new RegExp("scala\\.([\\s\\S]*)");
var refinementMatcher = new RegExp("(.*)\\$<refinement>"); // scalaz.syntax.ApplyOps$<refinement>
var tupleMatcher = /^\(.*\)/;
exports.fixQualifiedTypeName = function (theType) {
    var refinementMatch = refinementMatcher.exec(theType.fullName);
    if (refinementMatch)
        return refinementMatch[1];
    else
        return theType.fullName;
};
function fixShortTypeName(theType) {
    var refinementMatch = refinementMatcher.exec(theType.fullName);
    if (refinementMatch)
        return _.last(_.split(theType.fullName, "."));
    else
        return typeConstructorFromName(theType.name);
}
exports.fixShortTypeName = fixShortTypeName;
function typeConstructorFromType(type) {
    return typeConstructorFromName(type.name);
}
exports.typeConstructorFromType = typeConstructorFromType;
function typeConstructorFromName(name) {
    return _.replace(name, /\[.*\]/, "");
}
exports.typeConstructorFromName = typeConstructorFromName;
// # For hover
// # typeNameFormatter: function from {name, fullName} -> Html/String
exports.formatTypeWith = function (typeNameFormatter) { return function (theType) {
    function recur(theType) {
        var formatParam = function (param) {
            var type = recur(param[1]);
            return param[0] + ": " + type;
        };
        var formatParamSection = function (paramSection) {
            var p = paramSection.params.map(formatParam);
            return p.join(", ");
        };
        var formatParamSections = function (paramSections) {
            var sections = paramSections.map(formatParamSection);
            return "(" + sections.join(")(") + ")";
        };
        var formatBasicType = function (theType) {
            var name = typeNameFormatter(theType);
            var typeArgs = theType.typeArgs;
            if (!typeArgs || typeArgs.length == 0)
                return name;
            else {
                var formattedTypeArgs = typeArgs.map(recur);
                if (theType.fullName == 'scala.<byname>')
                    return "=> " + formattedTypeArgs.join(", ");
                else if (theType.fullName == 'scala.<repeated>')
                    return formattedTypeArgs.join(", ") + "*";
                else if (theType.fullName == "scala.Function1") {
                    var i = formattedTypeArgs[0];
                    var o = formattedTypeArgs[1];
                    return i + " => " + o;
                }
                else if (functionMatcher.test(theType.fullName)) {
                    var result = _.last(formattedTypeArgs);
                    var params = _.initial(formattedTypeArgs);
                    return "(" + params.join(", ") + ") => " + result;
                }
                else if (tupleMatcher.test(theType.name)) {
                    return "(" + formattedTypeArgs.join(", ") + ")";
                }
                else
                    return name + ("[" + formattedTypeArgs.join(", ") + "]");
            }
        };
        if (theType.typehint === "ArrowTypeInfo")
            return formatParamSections(theType.paramSections) + ": " + recur(theType.resultType);
        else if (theType.typehint === "BasicTypeInfo")
            return formatBasicType(theType);
    }
    return recur(theType);
}; };
function formatImplicitInfo(info) {
    if (info.typehint == 'ImplicitParamInfo') {
        var implicitParamInfo = info;
        return "Implicit parameters added to call of " + implicitParamInfo.fun.localName + ": (" + _.map(implicitParamInfo.params, function (p) { return p.localName; }).join(", ") + ")";
    }
    else if (info.typehint == 'ImplicitConversionInfo') {
        var implicitConversionInfo = info;
        return "Implicit conversion: " + implicitConversionInfo.fun.localName;
    }
}
exports.formatImplicitInfo = formatImplicitInfo;
exports.formatType = exports.formatTypeWith(typeConstructorFromType);

//# sourceMappingURL=data:application/json;charset=utf8;base64,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LENBQUMsTUFBRyxDQUFBO0lBQ3pKLENBQUM7SUFBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsSUFBSSxDQUFDLFFBQVEsSUFBSSx3QkFBd0IsQ0FBQyxDQUFDLENBQUM7UUFDbkQsSUFBTSxzQkFBc0IsR0FBK0IsSUFBSSxDQUFBO1FBQy9ELE1BQU0sQ0FBQywwQkFBd0Isc0JBQXNCLENBQUMsR0FBRyxDQUFDLFNBQVcsQ0FBQTtJQUN6RSxDQUFDO0FBQ0wsQ0FBQztBQVJlLDBCQUFrQixxQkFRakMsQ0FBQTtBQUVZLGtCQUFVLEdBQUcsc0JBQWMsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDIiwiZmlsZSI6ImxpYi9mb3JtYXR0aW5nLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGFwaSA9IHJlcXVpcmUoXCIuL3NlcnZlci1hcGkvc2VydmVyLXByb3RvY29sXCIpO1xuXG5pbXBvcnQgXyA9IHJlcXVpcmUgKCdsb2Rhc2gnKTtcblxuY29uc3QgZnVuY3Rpb25NYXRjaGVyID0gbmV3IFJlZ0V4cChcInNjYWxhXFxcXC5GdW5jdGlvblxcXFxkezEsMn1cIilcbmNvbnN0IHNjYWxhUGFja2FnZU1hdGNoZXIgPSBuZXcgUmVnRXhwKFwic2NhbGFcXFxcLihbXFxcXHNcXFxcU10qKVwiKVxuY29uc3QgcmVmaW5lbWVudE1hdGNoZXIgPSBuZXcgUmVnRXhwKFwiKC4qKVxcXFwkPHJlZmluZW1lbnQ+XCIpIC8vIHNjYWxhei5zeW50YXguQXBwbHlPcHMkPHJlZmluZW1lbnQ+XG5jb25zdCB0dXBsZU1hdGNoZXIgPSAvXlxcKC4qXFwpLztcblxuZXhwb3J0IGNvbnN0IGZpeFF1YWxpZmllZFR5cGVOYW1lID0gKHRoZVR5cGUpID0+IHtcbiAgICBjb25zdCByZWZpbmVtZW50TWF0Y2ggPSByZWZpbmVtZW50TWF0Y2hlci5leGVjKHRoZVR5cGUuZnVsbE5hbWUpXG4gICAgaWYocmVmaW5lbWVudE1hdGNoKVxuICAgICAgcmV0dXJuIHJlZmluZW1lbnRNYXRjaFsxXVxuICAgIGVsc2VcbiAgICAgIHJldHVybiB0aGVUeXBlLmZ1bGxOYW1lXG59XG4gICAgXG5leHBvcnQgZnVuY3Rpb24gZml4U2hvcnRUeXBlTmFtZSh0aGVUeXBlOiBhcGkuVHlwZSkge1xuICAgIGNvbnN0IHJlZmluZW1lbnRNYXRjaCA9IHJlZmluZW1lbnRNYXRjaGVyLmV4ZWModGhlVHlwZS5mdWxsTmFtZSlcbiAgICBpZihyZWZpbmVtZW50TWF0Y2gpXG4gICAgICAgIHJldHVybiBfLmxhc3QoXy5zcGxpdCh0aGVUeXBlLmZ1bGxOYW1lLCBcIi5cIikpXG4gICAgZWxzZVxuICAgICAgICByZXR1cm4gdHlwZUNvbnN0cnVjdG9yRnJvbU5hbWUodGhlVHlwZS5uYW1lKVxufSAgIFxuICAgIFxuZXhwb3J0IGZ1bmN0aW9uIHR5cGVDb25zdHJ1Y3RvckZyb21UeXBlKHR5cGU6IGFwaS5UeXBlKSB7XG4gICAgcmV0dXJuIHR5cGVDb25zdHJ1Y3RvckZyb21OYW1lKHR5cGUubmFtZSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB0eXBlQ29uc3RydWN0b3JGcm9tTmFtZShuYW1lOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gXy5yZXBsYWNlKG5hbWUsIC9cXFsuKlxcXS8sIFwiXCIpO1xufSBcbiAgICBcbi8vICMgRm9yIGhvdmVyXG4vLyAjIHR5cGVOYW1lRm9ybWF0dGVyOiBmdW5jdGlvbiBmcm9tIHtuYW1lLCBmdWxsTmFtZX0gLT4gSHRtbC9TdHJpbmdcbmV4cG9ydCBjb25zdCBmb3JtYXRUeXBlV2l0aCA9ICh0eXBlTmFtZUZvcm1hdHRlcjogKHg6IGFwaS5UeXBlKSA9PiBzdHJpbmcpID0+ICh0aGVUeXBlOiBhbnkpID0+IHtcbiAgICBmdW5jdGlvbiByZWN1cih0aGVUeXBlKSB7XG5cbiAgICAgICAgY29uc3QgZm9ybWF0UGFyYW0gPSAocGFyYW0pID0+IHtcbiAgICAgICAgICBjb25zdCB0eXBlID0gcmVjdXIocGFyYW1bMV0pXG4gICAgICAgICAgcmV0dXJuIGAke3BhcmFtWzBdfTogJHt0eXBlfWBcbiAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgIGNvbnN0IGZvcm1hdFBhcmFtU2VjdGlvbiA9IChwYXJhbVNlY3Rpb24pID0+IHtcbiAgICAgICAgICBjb25zdCBwID0gcGFyYW1TZWN0aW9uLnBhcmFtcy5tYXAoZm9ybWF0UGFyYW0pXG4gICAgICAgICAgcmV0dXJuIHAuam9pbihcIiwgXCIpXG4gICAgICAgIH1cblxuICAgICAgICBjb25zdCBmb3JtYXRQYXJhbVNlY3Rpb25zID0gKHBhcmFtU2VjdGlvbnMpID0+IHtcbiAgICAgICAgICBjb25zdCBzZWN0aW9ucyA9IHBhcmFtU2VjdGlvbnMubWFwKGZvcm1hdFBhcmFtU2VjdGlvbilcbiAgICAgICAgICByZXR1cm4gXCIoXCIgKyBzZWN0aW9ucy5qb2luKFwiKShcIikgKyBcIilcIlxuICAgICAgICB9XG5cbiAgICAgICAgY29uc3QgZm9ybWF0QmFzaWNUeXBlID0gKHRoZVR5cGUpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG5hbWUgPSB0eXBlTmFtZUZvcm1hdHRlcih0aGVUeXBlKVxuICAgICAgICAgICAgICBcbiAgICAgICAgICAgIGNvbnN0IHR5cGVBcmdzID0gdGhlVHlwZS50eXBlQXJnc1xuICAgICAgICAgICAgaWYoISB0eXBlQXJncyB8fCB0eXBlQXJncy5sZW5ndGggPT0gMClcbiAgICAgICAgICAgICAgcmV0dXJuIG5hbWVcbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICBjb25zdCBmb3JtYXR0ZWRUeXBlQXJncyA9IHR5cGVBcmdzLm1hcChyZWN1cilcbiAgICAgICAgICAgICAgaWYodGhlVHlwZS5mdWxsTmFtZSA9PSAnc2NhbGEuPGJ5bmFtZT4nKVxuICAgICAgICAgICAgICAgIHJldHVybiBcIj0+IFwiICsgZm9ybWF0dGVkVHlwZUFyZ3Muam9pbihcIiwgXCIpXG4gICAgICAgICAgICAgIGVsc2UgaWYodGhlVHlwZS5mdWxsTmFtZSA9PSAnc2NhbGEuPHJlcGVhdGVkPicpXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZvcm1hdHRlZFR5cGVBcmdzLmpvaW4oXCIsIFwiKSArIFwiKlwiXG4gICAgICAgICAgICAgIGVsc2UgaWYodGhlVHlwZS5mdWxsTmFtZSA9PSBcInNjYWxhLkZ1bmN0aW9uMVwiKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaSA9IGZvcm1hdHRlZFR5cGVBcmdzWzBdXG4gICAgICAgICAgICAgICAgY29uc3QgbyA9IGZvcm1hdHRlZFR5cGVBcmdzWzFdXG4gICAgICAgICAgICAgICAgcmV0dXJuIGkgKyBcIiA9PiBcIiArIG9cbiAgICAgICAgICAgICAgfSBlbHNlIGlmKGZ1bmN0aW9uTWF0Y2hlci50ZXN0KHRoZVR5cGUuZnVsbE5hbWUpKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcmVzdWx0ID0gXy5sYXN0KGZvcm1hdHRlZFR5cGVBcmdzKVxuICAgICAgICAgICAgICAgIGNvbnN0IHBhcmFtcyA9IF8uaW5pdGlhbChmb3JtYXR0ZWRUeXBlQXJncylcbiAgICAgICAgICAgICAgICByZXR1cm4gYCgke3BhcmFtcy5qb2luKFwiLCBcIil9KSA9PiAke3Jlc3VsdH1gXG4gICAgICAgICAgICAgIH0gZWxzZSBpZih0dXBsZU1hdGNoZXIudGVzdCh0aGVUeXBlLm5hbWUpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGAoJHtmb3JtYXR0ZWRUeXBlQXJncy5qb2luKFwiLCBcIil9KWBcbiAgICAgICAgICAgICAgfSBlbHNlXG4gICAgICAgICAgICAgICAgcmV0dXJuIG5hbWUgKyBgWyR7Zm9ybWF0dGVkVHlwZUFyZ3Muam9pbihcIiwgXCIpfV1gXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZih0aGVUeXBlLnR5cGVoaW50ID09PSBcIkFycm93VHlwZUluZm9cIilcbiAgICAgICAgICByZXR1cm4gZm9ybWF0UGFyYW1TZWN0aW9ucyh0aGVUeXBlLnBhcmFtU2VjdGlvbnMpICsgXCI6IFwiICsgcmVjdXIodGhlVHlwZS5yZXN1bHRUeXBlKVxuICAgICAgICBlbHNlIGlmKHRoZVR5cGUudHlwZWhpbnQgPT09IFwiQmFzaWNUeXBlSW5mb1wiKVxuICAgICAgICAgIHJldHVybiBmb3JtYXRCYXNpY1R5cGUodGhlVHlwZSlcbiAgICB9XG4gICAgcmV0dXJuIHJlY3VyKHRoZVR5cGUpXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmb3JtYXRJbXBsaWNpdEluZm8oaW5mbzogYXBpLkltcGxpY2l0UGFyYW1JbmZvIHwgYXBpLkltcGxpY2l0Q29udmVyc2lvbkluZm8pOiBzdHJpbmcge1xuICAgIGlmIChpbmZvLnR5cGVoaW50ID09ICdJbXBsaWNpdFBhcmFtSW5mbycpIHtcbiAgICAgICAgY29uc3QgaW1wbGljaXRQYXJhbUluZm8gPSA8YXBpLkltcGxpY2l0UGFyYW1JbmZvPmluZm9cbiAgICAgICAgcmV0dXJuIGBJbXBsaWNpdCBwYXJhbWV0ZXJzIGFkZGVkIHRvIGNhbGwgb2YgJHtpbXBsaWNpdFBhcmFtSW5mby5mdW4ubG9jYWxOYW1lfTogKCR7Xy5tYXAoaW1wbGljaXRQYXJhbUluZm8ucGFyYW1zLCAocCkgPT4gcC5sb2NhbE5hbWUpLmpvaW4oXCIsIFwiKX0pYFxuICAgIH0gZWxzZSBpZiAoaW5mby50eXBlaGludCA9PSAnSW1wbGljaXRDb252ZXJzaW9uSW5mbycpIHtcbiAgICAgICAgY29uc3QgaW1wbGljaXRDb252ZXJzaW9uSW5mbyA9IDxhcGkuSW1wbGljaXRDb252ZXJzaW9uSW5mbz5pbmZvXG4gICAgICAgIHJldHVybiBgSW1wbGljaXQgY29udmVyc2lvbjogJHtpbXBsaWNpdENvbnZlcnNpb25JbmZvLmZ1bi5sb2NhbE5hbWV9YFxuICAgIH1cbn1cblxuZXhwb3J0IGNvbnN0IGZvcm1hdFR5cGUgPSBmb3JtYXRUeXBlV2l0aCh0eXBlQ29uc3RydWN0b3JGcm9tVHlwZSk7XG4iXX0=
